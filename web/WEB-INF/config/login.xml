<?xml version="1.0" encoding="utf-8"?>
<xforms>

    <xform desc="login" id="loginform">
        <xhandle desc="登陆" id="loginhand" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from t_user WHERE   @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@name AND @password ">
                    <xfltpara id="name" nrp="1=1" para="name" sql="name = ':name'">
                    </xfltpara>
                    <xfltpara id="password" nrp="1=1" para="password" sql="password = ':password'">
                    </xfltpara>            
                </xflt>      
            </xsql>
                       
        </xhandle>                 
    </xform>
    
    <xform desc="主页" id="main">
        <xhand id="home" rtn="main.jsp" rtnype="PGE">
            
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from t_user WHERE   @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@id">
                    <xfltpara id="id" nrp="1=1" para="id" sql="id = ':id'">
                    </xfltpara>
                </xflt>      
            </xsql>       

             
        </xhand>
    </xform>
    
    <xform desc="" id="map">
        <xhandle desc="查询所有网关信息" id="map" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from t_baseinfo where @CONDITION " var="bootstrap">
                <xflt id="CONDITION" nrp="" tpl="@comaddr AND @name">
                    <xfltpara id="comaddr" nrp="1=1" para="comaddr" sql="comaddr = ':comaddr'">
                    </xfltpara>
                    <xfltpara id="name" nrp="1=1" para="name" sql="name = ':name'">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle>
        <xhandle desc="查询所有灯具信息" id="lamp" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from t_lamp where @CONDITION " var="bootstrap">
                <xflt id="CONDITION" nrp="" tpl="@l_comaddr AND @l_name">
                    <xfltpara id="l_comaddr" nrp="1=1" para="l_comaddr" sql="l_comaddr = ':l_comaddr'">
                    </xfltpara>
                    <xfltpara id="l_name" nrp="1=1" para="l_name" sql="l_name = ':l_name'">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle>
        <xhandle desc="查询所有经纬度" id="lnglat" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from t_baseinfo" var="rs">
            </xsql>
        </xhandle>
        <xhandle desc="查询所有网关" id="getallcomaddr" rtnype="JSON">
            <xsql id="a2" list="true" page="true" tpe="SQL" tpl="SELECT comaddr  FROM t_baseinfo" var="rs">
<!--                <xflt id="CONDITION" nrp="" tpl="@comaddr">
                    <xfltpara id="comaddr" nrp="1=1" para="comaddr" sql="comaddr = ':comaddr'">
                    </xfltpara>
                </xflt>      -->
            </xsql>               
        </xhandle>
         <xhandle desc="修改网关经纬度" id="updatelnglat" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="Longitude,latitude"  tpe="DDL" tpl="update t_baseinfo set Longitude=':Longitude',latitude=':latitude' where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@comaddr">
                    <xfltpara id="comaddr" nrp="1=1" para="comaddr" sql="comaddr=:comaddr">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle> 
        <xhandle desc="修改灯具经纬度" id="updateLamplnglat" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="Longitude,latitude"  tpe="DDL" tpl="update t_lamp set Longitude=':Longitude',latitude=':latitude' where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@id">
                    <xfltpara id="id" nrp="1=1" para="id" sql="id=:id">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle> 
        <xhandle desc="查询灯具分布列表" id="queryLamp" rtnype="JSON">
            <xsql id="a2" list="true" page="true" tpe="SQL" tpl="SELECT *  FROM t_lamp  AS tb where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@comaddr">
                    <xfltpara id="comaddr" nrp="1=1" para="comaddr" sql="comaddr = ':comaddr'">
                    </xfltpara>
                </xflt>      
            </xsql>               
        </xhandle>
    </xform>
    
    
    
     <xform desc="详细数据" id="reportmanage">
        <xhand id="getMoth"   rtnype="JSON">
            <xsql id="m1" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=1 order by day desc" var="M1">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql> 
            <xsql id="m2" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=2 order by day desc" var="M2">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>           
            
            <xsql id="m3" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=3 order by day desc" var="M3">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>

            <xsql id="m4" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=4 order by day desc" var="M4">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql> 

           <xsql id="m5" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=5 order by day desc" var="M5">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
           
            <xsql id="m6" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=6 order by day desc" var="M6">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>        
            
            <xsql id="m7" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=7 order by day desc" var="M7">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
            
             <xsql id="m8" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=8 order by day desc" var="M8">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
            
            <xsql id="m9" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=9 order by day desc" var="M9">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
            
            <xsql id="m10" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=10 order by day desc" var="M10">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
            
            <xsql id="m11" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=11 order by day desc" var="M11">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>
            
            <xsql id="m12" list="true" page="true" tpe="SQL" tpl="select  power,month(day) as month, year(day) from t_records where @CONDITION and month(day)=12 order by day desc" var="M12">
                <xflt id="CONDITION" nrp="" tpl="@year(day)">
                    <xfltpara id="year(day)" nrp="1=1" para="year" sql="year(day) = ':year'">
                    </xfltpara>
                </xflt>      
            </xsql>

        </xhand>
    </xform>
    
    <xform desc="用户管理" id="usermanage">
        <xhand des="查看拥有操作权限" id="power"  rtnype="JSON">    
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select code,roletype,enable from t_role where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@roletype AND @code">
                    <xfltpara id="roletype" nrp="1=1" para="roletype" sql="roletype = ':roletype'">
                    </xfltpara>
                    <xfltpara id="code" nrp="1=1" para="code" sql="code like ':code_%'">
                    </xfltpara>
                </xflt>      
            </xsql>            
        </xhand>
         <xhandle desc="查看所有角色" id="rolemenu" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="SELECT DISTINCT roletype as id,name as text FROM t_role " var="list">
            </xsql>
        </xhandle> 
        <xhandle desc="添加用户" id="addUser" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="name,sex,phone,department,email,password,pid,m_code" tpe="DDL" tpl="insert into t_user(name,sex,phone,department,email,password,pid,m_code) values(':name',':sex',':phone',':department',':email',':password',':pid',':m_code') " var="rs">
            </xsql>
        </xhandle>
        <xhandle desc="修改用户" id="editUser" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="department,sex,email,phone,pid,name,m_code" tpe="DDL" tpl="update t_user set department=':department',sex=':sex',email=':email',phone=':phone',pid=':pid',name=':name',m_code=':m_code' where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@id ">
                    <xfltpara id="id" nrp="1=1" para="id" sql="id=:id">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle> 
        <xhandle desc="修改密码" id="updatePwd" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="password" tpe="DDL" tpl="update t_user set password=':password' where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@id ">
                    <xfltpara id="id" nrp="1=1" para="id" sql="id=:id">
                    </xfltpara>
                </xflt>
            </xsql>
        </xhandle>  
    </xform>
    
    <xform desc="权限管理" id="rolemanage">
         <xhandle desc="权限分配" id="getpower" rtn="rs" rtnype="JSON">
            <xsql id="a1" para="enable"  tpe="DDL" tpl=" update t_role set enable=':enable' where @CONDITION " var="rs">
                <xflt id="CONDITION" nrp="" tpl="@code AND @roletype">
                    <xfltpara id="code" nrp="1=1" para="code" sql="code=:code">
                    </xfltpara>
                    <xfltpara id="roletype" nrp="1=1" para="roletype" sql="roletype=:roletype">
                    </xfltpara>
                </xflt>
                
            </xsql>
        </xhandle> 
    </xform>
    
    
    <xform desc="测试" id="table">
        <xhandle desc="jk" id="tabletest" rtnype="JSON">
            <xsql id="a1" list="true" page="true" tpe="SQL" tpl="select * from  t_user " var="bootstrap">
                <!--                <xflt id="CONDITION" nrp="" tpl="@u_phone AND @u_name ">
                    <xfltpara id="u_phone" nrp="1=1" para="u_phone" sql="u_phone = ':u_phone'"> 
                    </xfltpara>
                    <xfltpara id="u_name" nrp="1=1" para="u_name" sql="u_name = ':u_name'">
                    </xfltpara>             
                </xflt>        -->
            </xsql>        
        </xhandle>                 
    </xform>
</xforms>

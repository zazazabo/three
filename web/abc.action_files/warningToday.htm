<!DOCTYPE html>
<html><head>
    <!-- base href="http://slighting.shuncom.com.cn/CloudPlatform/" -->
    
    <title>Realtime Alarm</title>
    


<!-- 公共head -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache"> 
	
	<link rel="stylesheet" type="text/css" href="warningToday_data/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="warningToday_data/bootstrap-table.css">
    <link rel="stylesheet" type="text/css" href="warningToday_data/layui.css">

    <style>
    *{margin:0;padding:0;}
    body,html{width:100%;height:100%;}
    .fixed-table-container{
        height:430px;
    }
    .table>tbody>tr>td{
    	font-size:14px;
    }
    .pull-right {
    	float: left!important;
	}
	.fixed-table-toolbar .columns-right{
		margin-left:0;
	}
    .pull-left {
    	float: right!important;
    	margin-right:2px;
	}
	#gravidaTable tr th{
		font-size:15px;
	}
	#gravidaTable tr td{
		font-size:14px;
	}
    </style>
  <link id="layuicss-laydate" rel="stylesheet" href="laydate.css" media="all"><link id="layuicss-layer" rel="stylesheet" href="layer.css" media="all"><link id="layuicss-skincodecss" rel="stylesheet" href="code.css" media="all"></head>
  
  <body>
        <div class="bodyBox" style="width:100%;height:100%;overflow:auto;">
            
            
            <div class="bootstrap-table"><div class="fixed-table-toolbar"><div class="bs-bars pull-left"><div class="zuheanniu" id="zuheanniu">
                <input class="btn btn-default ctrol" value="处理报警" id="handle" type="button">
                <input class="btn btn-default back" style="width:40px;height:30px;background-image:url(imgs/back.png);background-repeat: no-repeat;background-position:7px 7px;" title="返回" type="button">
            </div></div><div class="columns columns-right btn-group pull-right"><button class="btn btn-default" type="button" name="refresh" aria-label="refresh" title="刷新"><i class="glyphicon glyphicon-refresh icon-refresh"></i></button></div></div><div class="fixed-table-container" style="padding-bottom: 0px;"><div class="fixed-table-header" style="display: none;"><table></table></div><div class="fixed-table-body"><div class="fixed-table-loading" style="top: 1px; display: none;">正在努力地加载数据中，请稍候……</div><table id="gravidaTable" style="width:100%;" class="text-nowrap table table-hover table-striped">
            <thead><tr><th class="bs-checkbox " style="width: 36px; " data-field="stats"><div class="th-inner "><input name="btSelectAll" type="checkbox"></div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="name"><div class="th-inner ">设备名称</div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="type_id"><div class="th-inner ">设备类型</div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="attr"><div class="th-inner ">警情类型</div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="timeStr"><div class="th-inner ">报警时间</div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="send_status"><div class="th-inner ">警情发送状态</div><div class="fht-cell"></div></th><th style="text-align: center; vertical-align: middle; " data-field="statusStr"><div class="th-inner ">解决状态</div><div class="fht-cell"></div></th></tr></thead><tbody><tr class="no-records-found"><td colspan="7">没有找到匹配的记录</td></tr></tbody></table></div><div class="fixed-table-footer" style="display: none;"><table><tbody><tr></tr></tbody></table></div></div><div class="fixed-table-pagination" style="display: none;"><div class="pull-left pagination-detail"><span class="pagination-info">&nbsp;共 0&nbsp;条</span><span class="page-list" style="display: none;">每页<span class="btn-group dropup"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="page-size">10</span> <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li role="menuitem" class="active"><a href="#">10</a></li></ul></span>条</span></div><div class="pull-right pagination" style="display: none;"><ul class="pagination"><li class="page-item page-pre"><a class="page-link" href="#">‹</a></li><li class="page-item page-next"><a class="page-link" href="#">›</a></li></ul></div></div></div><div class="clearfix"></div>
        </div>
  
  <script type="text/javascript" src="warningToday_data/jquery.js"></script>
  <script type="text/javascript" src="warningToday_data/bootstrap.js"></script>
  <script type="text/javascript" src="warningToday_data/bootstrap-table.js"></script>
  <script type="text/javascript" src="warningToday_data/zh_CN_bak.js"></script>
  <script type="text/javascript" src="warningToday_data/layui.js"></script>
  <script type="text/javascript" src="warningToday_data/selectAjaxFunction.js"></script>
  <script>
  $(function(){
    $(".back").click(function() {
        $('#alarmTable', window.parent.document).css("display", "none");
    });
    
    $('#gravidaTable').bootstrapTable({
        //height: 473,                  //行高,表格高度超过固定行高将出现滚动条
        striped: true,                //隔行变身 
        pagination: true, // 开启分页功能
        //search:true,
        pageNumber: 1,
        cache: false,
        queryParams: function (params) {
            var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
                //search: params.search,
                year: new Date().getFullYear(),
                month: new Date().getMonth() + 1,
                date: new Date().getDate()
            };  
            return temp;
        },
        //searchOnEnterKey: true,
        pageSize: 10, // 设置默认分页为 50
        pageList: [ 10 , 15 , 20 ,50 , 100 ], // 自定义分页列表
        url: 'readAlarmHistoryIndex.action',      //服务器url
        toolbar:'#zuheanniu',           //工具按钮用哪个容器 
        //showColumns:true,             //是否显示所有列
        //cardView: false,              //是否显示详细视图
        //showToggle:true,              //是否显示详细视图和列表视图的切换按钮 
        showRefresh: true,            //是否显示刷新按钮
        clickToSelect: true,          //是否启用点击选中行
        singleSelect:false,           //复选框只能选择一条记录
        smartDisplay: true,           // 智能显示 pagination 和 cardview 等
        sidePagination: "client",     //分页方式：client客户端分页，server服务端分页（*）     
        columns: [
        {
        field:"stats",
        checkbox:true
        },
        {
        field:"name",
        title:"设备名称",
        align: 'center',
        valign: 'middle',
        sortable: false
        },
        {
        field:"type_id",
        title:"设备类型",
        align: 'center',
        valign: 'middle',
        sortable: false
        },
        {
        field:"attr",
        title:"警情类型",
        align: 'center',
        valign: 'middle',
        sortable: false
        },
        {
        field:"timeStr",
        title:"报警时间",
        align: 'center',
        valign: 'middle',
        sortable: false,
        formatter: function(value, row, index) {
            if(value != undefined) {
                return UTCDateStrToLocaleDateStr(value, 'zh', 'zh');
            }
        }
        },
        /* {
        field:"message",
        title:"告警信息",
        align: 'center',
        valign: 'middle',
        sortable: false
        }, */
        {
        field:"send_status",
        title:"警情发送状态",
        align: 'center',
        valign: 'middle',
        sortable: false
        },
        {
        field:"statusStr",
        title:"解决状态",
        align: 'center',
        valign: 'middle',
        sortable: false
        }
        /* {
        field:"solve_time",
        title:"解决时间",
        align: 'center',
        valign: 'middle',
        sortable: false
        },
        {
        field:"solver",
        title:"解决人",
        align: 'center',
        valign: 'middle',
        sortable: false
        } */
        /* {
        field:"modify_date",
        title:"所属项目",
        align: 'center',
        valign: 'middle',
        sortable: false
        } */],
        onLoadSuccess: function(data) {
            $('#alarmNumber', window.parent.document).html(data.length);
        }
    });
    
    $("#handle").click(function() {
        var selectRow = $("#gravidaTable").bootstrapTable("getSelections");
        if(selectRow.length != 0) {
            var controlArray = [selectRow.length];
            for(var i = 0; i < selectRow.length; i++) {
                var control = {
                    deviceId: selectRow[i].deviceId,
                    timeString: selectRow[i].timeStr,
                    alarmType: selectRow[i].alarmType
                };
                controlArray[i] = control;
            }
            $.ajax({
                type: "POST",
                url: "handleAlarm.action",
                data: JSON.stringify(controlArray),
                contentType: "application/json",
                success: function(result) {
                    if(result.result == "0") {
                        layer.open({
                            content: '操作成功!', icon: 1, yes: function(index, layero) {
                                layer.close(index);
                            }, success: function(layero, index) {
                                $('#gravidaTable').bootstrapTable('refresh');
                            }
                        });
                    }
                },
                error:function() {
                }
            });
        } else {
            layer.open({
                content: '您还没有选择您要处理的警情哟!', icon: 4, yes: function(index, layero) {
                    layer.close(index);
                }
            });
        }
    });
})
  </script>

</body></html>